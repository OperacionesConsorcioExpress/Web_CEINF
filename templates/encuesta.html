<!DOCTYPE html> <!-- DeclaraciÃ³n del tipo de documento para HTML5 -->
<!--
  Encuesta BI â€“ VersiÃ³n comentada lÃ­nea por lÃ­nea
  - Mantiene los mismos "name" de inputs para que el backend siga funcionando igual.
  - Tema: Claro por defecto; si no hay preferencia guardada, sigue el tema del SO (prefers-color-scheme).
  - Toggle de tema con persistencia en localStorage y escucha de cambios del SO.
  - DistribuciÃ³n en desktop: 2 columnas con Grid Areas.
      Columna izquierda -> Reporte, Ãrea, Cargo, Frecuencia
      Columna derecha   -> Calificaciones, Comentarios
    En mÃ³vil/tablet (<=900px): 1 columna (apilado).
  - Modo â€œcompactâ€ automÃ¡tico si el viewport es bajo (<= 800px) y manual con class="compact" en <body>.
-->
<html lang="es"> <!-- Idioma del documento -->
<head> <!-- Cabecera del documento -->
  <meta charset="UTF-8" /> <!-- CodificaciÃ³n de caracteres -->
  <title>Encuesta Reporte BI</title> <!-- TÃ­tulo de la pestaÃ±a del navegador -->
  <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- Escala para dispositivos mÃ³viles -->
  <link rel="stylesheet" href="{{ url_for('static', path='/css/encuesta.css') }}?v={{ static_version }}">  <!-- href="/static/css/encuesta.css"> -- Enlace a la hoja de estilos de la encuesta -->
</head> <!-- Fin de la cabecera -->

<!--
  SUGERENCIA: si quieres forzar el modo compacto siempre, agrega "compact" a la clase del body:
  <body class="body compact">
-->
<body class="body"> <!-- Cuerpo del documento; clase "body" aplica tipografÃ­a/tema global -->
  <main class="survey-shell"> <!-- Contenedor principal que ocupa todo el viewport y define padding lateral -->
    <header class="survey-header"> <!-- Encabezado: tÃ­tulo + barra de logos + botÃ³n de tema -->
      <div class="title-wrap"> <!-- Grupo de tÃ­tulo y subtÃ­tulo -->
        <h1 class="title">Encuesta de SatisfacciÃ³n</h1> <!-- TÃ­tulo visible (color cambia por tema) -->
        <p class="subtitle">Tu feedback mejora nuestros informes BI.</p> <!-- SubtÃ­tulo descriptivo -->
      </div>

      <div class="brand-right"> <!-- Lado derecho del header: logos + botÃ³n de tema -->
        <div class="brand-bar" aria-label="Logos corporativos"> <!-- Barra de logos con borde/sombra -->
          <img src="/static/img/ce_logo.png" class="brand-logo ce" alt="Consorcio Express" title="Consorcio Express"> <!-- Logo CE -->
          <span class="divider" aria-hidden="true"></span> <!-- Separador visual -->
          <img src="/static/img/power_bi.png" class="brand-logo pbi" alt="Power BI" title="Power BI"> <!-- Logo Power BI -->          
          <span class="divider" aria-hidden="true"></span> <!-- Separador visual -->
          <img src="/static/img/centro_info_logo.png" class="brand-logo ci" alt="Centro de InformaciÃ³n" title="Centro de InformaciÃ³n"> <!-- Logo CI -->
        </div>

        <button type="button" class="btn-secondary theme-toggle" id="themeToggle" aria-label="Cambiar tema">
          ðŸŒš Oscuro
        </button> <!-- BotÃ³n para alternar entre tema claro/oscuro; texto se actualiza vÃ­a JS -->
      </div>
    </header> <!-- Fin del header -->

    <form method="post" action="/encuesta" class="survey-grid"> <!-- Form principal; grid de 2 columnas (desktop) -->
      <!-- BLOQUES COLUMNA IZQUIERDA -->
      <section class="card reporte"> <!-- Tarjeta: reporte a evaluar; Ã¡rea de grid "reporte" -->
        <label class="label">Informe a evaluar</label> <!-- Etiqueta del campo -->

        {% if nombre_reporte %} <!-- Si llega desde QR con ?reporte=... -->
          <input id="reporte" name="reporte" type="text" value="{{ nombre_reporte }}" class="input readonly" readonly required> <!-- Campo solo lectura con el valor -->
          <p class="hint">Valor recibido desde el enlace/cÃ³digo QR.</p> <!-- Pista al usuario -->
        {% else %} <!-- Si NO viene desde QR -->
          {% if lista_reportes is not none %} <!-- Si hubo conexiÃ³n a BD (lista existe; puede estar vacÃ­a) -->
            <select id="reporte" name="reporte" class="select" required> <!-- Selector con opciones traÃ­das de la BD -->
              {% if lista_reportes|length > 0 %} <!-- Si hay elementos para listar -->
                <option value="">Seleccione un reporte</option> <!-- Placeholder de selecciÃ³n -->
                {% for r in lista_reportes %} <!-- Itera cada nombre -->
                  <option value="{{ r }}">{{ r }}</option> <!-- OpciÃ³n con el nombre del reporte -->
                {% endfor %}
              {% else %} <!-- Si la lista estÃ¡ vacÃ­a -->
                <option value="" disabled selected>No hay reportes disponibles</option> <!-- Informa que no hay datos -->
              {% endif %}
            </select>
            <p class="hint">Selecciona el informe que deseas evaluar.</p> <!-- Ayuda adicional -->
          {% else %} <!-- Si fallÃ³ la BD (lista_reportes es None) -->
            <input id="reporte" name="reporte" type="text" class="input" placeholder="Escriba el nombre del reporte" required> <!-- Fallback manual -->
            <p class="hint error">No se pudo cargar la lista desde la base de datos.</p> <!-- Mensaje de error -->
          {% endif %}
        {% endif %}
      </section>

      <section class="card area"> <!-- Tarjeta: Ã¡rea del evaluador; Ã¡rea de grid "area" -->
        <label for="area_evaluacion" class="label">Â¿Desde quÃ© Ã¡rea nos estÃ¡ evaluando?</label> <!-- Etiqueta -->
        <input id="area_evaluacion" name="area_evaluacion" type="text" class="input" placeholder="Ej.: Gerencia, Operaciones, Finanzas" required> <!-- Input de texto -->
      </section>

      <section class="card cargo"> <!-- Tarjeta: cargo del evaluador; Ã¡rea de grid "cargo" -->
        <label for="cargo_evaluador" class="label">Â¿CuÃ¡l es su cargo dentro de esta Ã¡rea?</label> <!-- Etiqueta -->
        <input id="cargo_evaluador" name="cargo_evaluador" type="text" class="input" placeholder="Ej.: Analista, Jefe, Coordinador" required> <!-- Input de texto -->
      </section>

      <!-- BLOQUES COLUMNA DERECHA -->
      <section class="card calificaciones"> <!-- Tarjeta: calificaciones (matriz 1â€“5); Ã¡rea de grid "calificaciones" -->
        <div class="block-head"> <!-- Encabezado del bloque (tÃ­tulo + hint) -->
          <h2 class="block-title">Calificaciones</h2> <!-- TÃ­tulo del bloque -->
          <p class="hint">1 = Muy baja / Nada â€” 5 = Excelente / MuchÃ­simo</p> <!-- Hint de escala -->
        </div>

        <div class="matrix"> <!-- Contenedor de la matriz 1â€“5 -->
          <div class="matrix-head"> <!-- Cabecera con nÃºmeros 1â€“5 -->
            <div class="cell"></div> <!-- Celda vacÃ­a (esquina superior izquierda) -->
            {% for n in [1,2,3,4,5] %} <!-- Loop de columnas 1..5 -->
              <div class="cell center">{{n}}</div> <!-- NÃºmero centrado -->
            {% endfor %}
          </div>

          <div class="matrix-row"> <!-- Fila: Claridad y precisiÃ³n -->
            <div class="cell row-label">Claridad y precisiÃ³n</div> <!-- Etiqueta fila -->
            {% for n in [1,2,3,4,5] %} <!-- Radios 1..5 -->
              <div class="cell center"> <!-- Celda centrada -->
                <input type="radio" id="cp_{{n}}" name="claridad_precision" value="{{n}}" required> <!-- Radio oculto visualmente (se estiliza con .dot) -->
                <label for="cp_{{n}}" class="dot"></label> <!-- Punto clicable que marca el radio -->
              </div>
            {% endfor %}
          </div>

          <div class="matrix-row"> <!-- Fila: Utilidad general -->
            <div class="cell row-label">Utilidad general</div> <!-- Etiqueta fila -->
            {% for n in [1,2,3,4,5] %} <!-- Radios 1..5 -->
              <div class="cell center">
                <input type="radio" id="ug_{{n}}" name="utilidad_general" value="{{n}}" required> <!-- Radio -->
                <label for="ug_{{n}}" class="dot"></label> <!-- Punto visual -->
              </div>
            {% endfor %}
          </div>

          <div class="matrix-row"> <!-- Fila: Apoyo a decisiones -->
            <div class="cell row-label">Apoyo a decisiones</div> <!-- Etiqueta fila -->
            {% for n in [1,2,3,4,5] %} <!-- Radios 1..5 -->
              <div class="cell center">
                <input type="radio" id="ud_{{n}}" name="utilidad_decisiones" value="{{n}}" required> <!-- Radio -->
                <label for="ud_{{n}}" class="dot"></label> <!-- Punto visual -->
              </div>
            {% endfor %}
          </div>
        </div> <!-- Fin de la matriz -->
      </section>

      <section class="card frecuencia"> <!-- Tarjeta: frecuencia de uso; Ã¡rea de grid "frecuencia" -->
        <label class="label">Â¿Con quÃ© frecuencia consulta el informe?</label> <!-- Etiqueta -->
        <div class="segmented"> <!-- Control segmentado tipo "pÃ­ldoras" -->
          <input type="radio" id="fq_diario"   name="frecuencia_uso" value="diario"  required> <!-- Radio oculto -->
          <label for="fq_diario">Diario</label> <!-- PÃ­ldora visible -->

          <input type="radio" id="fq_semanal"  name="frecuencia_uso" value="semanal"> <!-- Radio oculto -->
          <label for="fq_semanal">Semanal</label> <!-- PÃ­ldora visible -->

          <input type="radio" id="fq_mensual"  name="frecuencia_uso" value="mensual"> <!-- Radio oculto -->
          <label for="fq_mensual">Mensual</label> <!-- PÃ­ldora visible -->

          <input type="radio" id="fq_eventual" name="frecuencia_uso" value="eventual"> <!-- Radio oculto -->
          <label for="fq_eventual">Eventual</label> <!-- PÃ­ldora visible -->
        </div>
      </section>

      <section class="card comentarios"> <!-- Tarjeta: comentarios; Ã¡rea de grid "comentarios" -->
        <label for="sugerencias_mejora" class="label">Â¿QuÃ© mejorarÃ­as de este informe?</label> <!-- Etiqueta -->
        <textarea id="sugerencias_mejora" name="sugerencias_mejora" rows="4" class="textarea" placeholder="Escribe tus comentarios..."></textarea> <!-- Ãrea de texto -->
      </section>

      <footer class="sticky"> <!-- Barra pegada al fondo del viewport con el botÃ³n de envÃ­o -->
        <button type="submit" class="btn-primary">Enviar respuesta</button> <!-- BotÃ³n de envÃ­o del formulario -->
      </footer>
    </form> <!-- Fin del formulario -->
  </main> <!-- Fin del contenedor principal -->

  <script>
    // =======================
    // THEME: inicializaciÃ³n, toggle, seguimiento del SO
    // =======================
    (function initTheme() { // IIFE para no contaminar el scope global
      const root  = document.documentElement; // <html>, donde pondremos data-theme
      const btn   = document.getElementById('themeToggle'); // botÃ³n de alternancia
      const media = window.matchMedia('(prefers-color-scheme: dark)'); // consulta de tema del SO
      const saved = localStorage.getItem('theme'); // preferencia guardada: 'light' | 'dark' | null
      let followOS = false; // bandera para saber si seguimos los cambios del SO

      function setTheme(mode) { // Cambia el atributo y el texto del botÃ³n
        root.setAttribute('data-theme', mode); // aplica tokens CSS del tema
        btn.textContent = (mode === 'dark') ? 'ðŸŒž Claro...' : 'ðŸŒš Oscuro'; // actualiza label del botÃ³n
      }

      // 1) Si hay preferencia del usuario, Ãºsala; si no, sigue el SO
      if (saved === 'light' || saved === 'dark') {
        setTheme(saved); // aplica preferencia persistida
      } else {
        setTheme(media.matches ? 'dark' : 'light'); // usa tema del SO al cargar
        followOS = true; // mientras no haya preferencia guardada, seguimos al SO
      }

      // 2) Reacciona a cambios del SO (solo si estamos siguiendo al SO)
      media.addEventListener('change', (e) => {
        if (followOS) setTheme(e.matches ? 'dark' : 'light'); // alterna segÃºn el SO
      });

      // 3) Toggle manual: fija preferencia y deja de seguir al SO
      btn.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light'; // invierte el modo
        followOS = false; // ya no seguimos al SO porque el usuario decidiÃ³
        localStorage.setItem('theme', next); // persistimos la preferencia
        setTheme(next); // aplicamos el nuevo tema
      });
    })();

    // =======================
    // COMPACT MODE: automÃ¡tico para pantallas bajitas (<= 800 px)
    // =======================
    (function initCompact() { // IIFE para modo compacto
      const apply = () => { // funciÃ³n que aplica o quita la clase
        const isSmall = window.innerHeight <= 800; // umbral de altura (ajustable)
        if (!document.body.classList.contains('compact')) { // si NO se forzÃ³ manual
          document.body.classList.toggle('compact-auto', isSmall); // alterna clase auto
        }
      };
      apply(); // evalÃºa al cargar
      window.addEventListener('resize', apply); // re-evalÃºa al cambiar tamaÃ±o
    })();
  </script> <!-- Fin del script de comportamiento -->
</body> <!-- Fin del body -->
</html> <!-- Fin del documento -->
<!--
  Fin del documento HTML de la encuesta.
  - Incluye comentarios para entender cada secciÃ³n y funcionalidad.
  - El cÃ³digo JavaScript maneja el tema y el modo compacto de forma eficiente.
  - La estructura es semÃ¡ntica y accesible, con etiquetas ARIA donde corresponde.
